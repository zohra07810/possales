<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="manifest" href="manifest.json">
<title>POS ‚Äì Main Page</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial; margin: 20px; }
  h1, h2, h3 { text-align: center; }
  .logo { display: block; margin: 0 auto 20px; max-width: 150px; }
  .menu, .cart { margin-bottom: 20px; }
  button { margin: 5px; padding: 5px 10px; cursor: pointer; }
 table {
  width: 100%;
  border-collapse: collapse;
  font-size: 16px;
}
  th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
  white-space: nowrap; /* keep cells in one line */
}

  .cart {
  overflow-x: auto; /* allow horizontal scroll if needed */
}

  .qty-container { display: flex; align-items: center; justify-content: center; }
  .qty-container button { padding: 3px 8px; margin: 0; font-size: 16px; cursor: pointer; }
  .qty-container span { margin: 0 5px; min-width: 20px; text-align: center; display: inline-block; font-size: 16px; }

  @media (max-width: 480px) {
    .qty-container button { padding: 2px 6px; font-size: 14px; }
    .qty-container span { font-size: 14px; min-width: 18px; }
  }

 @media (max-width: 480px) {
  table {
    font-size: 12px;
  }

  th, td {
    padding: 3px;
  }

  th:nth-child(4) { font-size: 10px; } /* Upgrade */
  th:nth-child(5) { font-size: 10px; } /* Action */
  
  .qty-container span { min-width: 15px; }
  .qty-container button { padding: 1px 3px; font-size: 10px; }
}

 .backBtn {
  display: block;            /* stays on its own line */
  width: auto;               /* only as wide as the content */
  background-color: #be3016; /* button color */
  color: white;              /* text color */
  border: none;
  padding: 4px 10px;         /* smaller padding */
  cursor: pointer;
  border-radius: 5px;
  margin-bottom: 10px;       /* space below button */
  font-size: 14px;           /* smaller font */
  text-align: left;          /* align text to left */
}


/* SAVE MODAL */
#saveModal {
  display: none;
  position: fixed; top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}
#saveModalContent {
  background: #06812b;
  color: white;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 350px;
  text-align: center;
}
#saveModalContent select {
  width: 90%;
  padding: 5px;
  margin: 5px 0;
  font-size: 16px;
}
#saveModalContent button {
  padding: 6px 12px;
  margin: 5px;
  cursor: pointer;
  border: none;
  border-radius: 5px;
  font-size: 14px;
}
#saveYes { background: white; color: #06812b; }
#saveCancel { background: #555; color: white; }

.payment-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 6px 0;
}

.payment-row span {
  font-size: 14px;
}

.payment-row input {
  width: 90px;
  padding: 4px;
  font-size: 14px;
}

/* Horizontal scroll for waitlist table only */
.waitlist-table-wrapper {
  overflow-x: auto;    /* allows horizontal scroll */
  overflow-y: hidden;  /* disables vertical scroll */
  width: 100%;
}

.waitlist-table-wrapper table {
  width: max-content; /* table can expand horizontally */
  min-width: 100%;    /* optional: ensures it fills container if small */
  border-collapse: collapse;
}

.waitlist-table-wrapper th, 
.waitlist-table-wrapper td {
  padding: 8px 12px;
  border: 1px solid #ccc;
  text-align: left;
  white-space: nowrap; /* prevent text from wrapping */
}




</style>
</head>
<body  style="background-color: #e0e4cd;">
<div class="waitlist-table-wrapper">
  <table id="waitlistTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Date</th>
        <th>Total</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>



<!-- Save Modal -->
<div id="saveModal">
  <div id="saveModalContent">

      <div style="margin-bottom:10px; font-size:16px; font-weight:bold; color: #e6ff07;">
    Total to Pay: ‚Ç±<span id="totalDue">0.00</span>
  </div>

  <div style="margin-top:12px; padding:8px; background:#056622; border-radius:6px;">
  <div style="font-size:14px;">
    <strong>Cash Change Calculator</strong>
  </div>

  <div style="margin-top:6px;">
    Cash Given: ‚Ç±
    <input type="number" id="cashGiven" placeholder="0.00"
           style="width:90px; padding:4px; font-size:14px;">
  </div>

  <div style="margin-top:6px; font-size:15px;">
    Change: ‚Ç±<span id="changeAmount">0.00</span>
  </div>
</div><br>

    <label>Payment Breakdown:</label>

    <div class="payment-row">
      <span>Cash</span>
      <input type="number" id="payCash" placeholder="0.00">
    </div>

    <div class="payment-row">
      <span>GCash</span>
      <input type="number" id="payGCash" placeholder="0.00">
    </div>

    <div class="payment-row">
      <span>Bank</span>
      <input type="number" id="payBank" placeholder="0.00">
    </div>

    <label style="margin-top:10px;">Service Type:</label>
    <select id="serviceSelect">
      <option value="Dine-in">Dine-in</option>
      <option value="Take-out">Take-out</option>
      <option value="Pickup">Pickup</option>
      <option value="Delivery">Delivery</option>
    </select>

    <div style="margin-top:10px;">
      <strong>Total Paid: ‚Ç±<span id="paidTotal">0.00</span></strong>
    </div>

    


    <button id="saveYes">Save</button>
    <button id="saveCancel">Cancel</button>
  </div>
</div>



<br>
<img src="baigsLogo.png" alt="Baig's Logo" class="logo">
<h1>Baig's POS</h1>

<div class="menu">
 <h2 style="color: #06812b;">Menu</h2>
  <div id="menuItems"></div>
</div>

<div class="cart">
  <h2>Cart</h2>
  <div style="overflow-x:auto; background: #d7eb80;">
    <table id="cartTable">
      <thead>
        <tr>
          <th>Item</th>
          <th>QTY</th>
          <th>Price</th>
          <th>Upgrade</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
   <br>
  <!-- Discount input -->
  <div style="margin-top: 10px;">
    <label for="discount">Discount Input (20% of this will be applied): </label>
    <input type="number" id="discount" value="0" min="0" style="width: 60px;">
  </div>

  <h4>Subtotal: ‚Ç±<span id="subtotal">0</span></h4>
  <h4>Discount: ‚Ç±<span id="discountAmount">0</span></h4>
  <h3>Total: ‚Ç±<span id="total">0</span></h3>
</div>

<div style="text-align: center; margin: 20px 0;">
 
  <button id="goReceiptBtn" 
          style="padding: 10px 20px; font-size: 16px; cursor: pointer; background: #796d04; color: #fff; border: none; border-radius: 5px;">
    Go to Receipt
  </button>
</div>

<div style=" text-align: center; margin: 20px 0;">
  <button onclick="goToHistory()" 
          style="padding: 10px 20px; font-size: 16px; cursor: pointer; background: #0c4b04; color: #fff; border: none; border-radius: 5px;">
    üìú View History
  </button>
</div>


<!-- Upgrade Modal -->
<div id="upgradeModal" style="
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  flex-direction: column;
">
  <div style="
    background: white;
    padding: 20px;
    border-radius: 10px;
    min-width: 250px;
    max-width: 90%;
    text-align: center;
  ">
    <h3 id="upgradeTitle">Edit Item</h3>
    <div style="margin-top: 10px;">
      <label>Food Name:</label><br>
      <input type="text" id="upgradeName" style="width: 90%; padding: 5px; margin-bottom: 10px;">
      <br>
      <label>Price:</label><br>
      <input type="number" id="upgradePrice" style="width: 90%; padding: 5px; margin-bottom: 10px;">
    </div>
    <button id="saveUpgrade" style="margin-top: 10px; padding: 10px; width: 45%; cursor: pointer;">Save</button>
    <button onclick="closeUpgradeModal()" style="margin-top: 10px; padding: 10px; width: 45%; cursor: pointer;">Cancel</button>
  </div>
</div>

</div>

<script>
const menu = {
  "Biryani": {
    "Chicken": { "Small": 120, "Regular": 180 },
    "Beef": { "Small": 130, "Regular": 200 }
  },
  "Kabsah": {
    "Chicken": { "Small": 110, "Regular": 170 },
    "Beef": { "Small": 125, "Regular": 190 }
  },
  "Shawarma": {
    "Chicken": { "Small": 80, "Regular": 120 },
    "Beef": { "Small": 90, "Regular": 140 }
  }
};

let cart = [];
const menuDiv = document.getElementById('menuItems');
const cartTableBody = document.querySelector('#cartTable tbody');
const subtotalSpan = document.getElementById('subtotal');
const discountSpan = document.getElementById('discountAmount');
const totalSpan = document.getElementById('total');
function renderCategories() {
  menuDiv.innerHTML = '';
  const title = document.createElement('h3');
  title.textContent = 'Select Category';
  menuDiv.appendChild(title);

  Object.keys(menu).forEach(category => {
    const btn = document.createElement('button');
    btn.textContent = category;
    btn.onclick = () => renderVariants(category);
    menuDiv.appendChild(btn);
  });
}

function renderVariants(category) {
  menuDiv.innerHTML = '';
  const title = document.createElement('h3');
  title.textContent = `Category: ${category}`;
  menuDiv.appendChild(title);

  // Back to main categories
  const mainBackBtn = document.createElement('button');
  mainBackBtn.className = 'backBtn';
  mainBackBtn.textContent = '‚¨Ö Back to Categories';
  mainBackBtn.onclick = () => renderCategories();
  menuDiv.appendChild(mainBackBtn);

  const variants = menu[category];
  Object.keys(variants).forEach(variant => {
    const btn = document.createElement('button');
    btn.textContent = variant;
    btn.onclick = () => renderSizes(category, variant);
    menuDiv.appendChild(btn);
  });
}

function renderSizes(category, variant) {
  menuDiv.innerHTML = '';
  const title = document.createElement('h3');
  title.textContent = `Category: ${category} | Variant: ${variant}`;
  menuDiv.appendChild(title);



  // Direct back to main categories
  const mainBackBtn = document.createElement('button');
  mainBackBtn.className = 'backBtn';
  mainBackBtn.textContent = '‚¨Ö Back to Categories';
  mainBackBtn.onclick = () => renderCategories();
  menuDiv.appendChild(mainBackBtn);

    // Back to previous variant menu
  const backBtn = document.createElement('button');
  backBtn.className = 'backBtn';
  backBtn.textContent = '‚¨Ö Back';
  backBtn.onclick = () => renderVariants(category);
  menuDiv.appendChild(backBtn);

  const sizes = menu[category][variant];
  Object.keys(sizes).forEach(size => {
    const price = sizes[size];
    const btn = document.createElement('button');
    btn.textContent = `${variant} (${size}) - ‚Ç±${price}`;
    btn.onclick = () => {
      cart.push({ name: `${category} - ${variant} (${size})`, price, qty: 1 });
      renderCart();
    };
    menuDiv.appendChild(btn);
  });
}


let currentUpgradeIndex = null; // track which cart item is being edited

function openUpgradeModal(item, index) {
  currentUpgradeIndex = index;
  const modal = document.getElementById('upgradeModal');
  document.getElementById('upgradeName').value = item.name;
  document.getElementById('upgradePrice').value = item.price;
  modal.style.display = 'flex';
}

function closeUpgradeModal() {
  document.getElementById('upgradeModal').style.display = 'none';
}

// Save changes
document.getElementById('saveUpgrade').addEventListener('click', () => {
  if (currentUpgradeIndex !== null) {
    const newName = document.getElementById('upgradeName').value.trim();
    const newPrice = parseFloat(document.getElementById('upgradePrice').value) || 0;

    cart[currentUpgradeIndex].name = newName || cart[currentUpgradeIndex].name;
    cart[currentUpgradeIndex].price = newPrice;
    renderCart();
    closeUpgradeModal();
  }
});



function renderCart() {
  cartTableBody.innerHTML = '';
  let subtotal = 0;

  cart.forEach((item, index) => {
    const row = document.createElement('tr');

    // Item name
    const nameCell = document.createElement('td');
    nameCell.textContent = item.name;
    row.appendChild(nameCell);

    // QTY
    const qtyCell = document.createElement('td');
    const qtyContainer = document.createElement('div');
    qtyContainer.className = 'qty-container';

    const minusBtn = document.createElement('button');
    minusBtn.textContent = '-';
    minusBtn.onclick = () => {
      if(item.qty > 1) { item.qty--; renderCart(); }
    };

    const qtySpan = document.createElement('span');
    qtySpan.textContent = item.qty;

    const plusBtn = document.createElement('button');
    plusBtn.textContent = '+';
    plusBtn.onclick = () => {
      item.qty++;
      renderCart();
    };

    qtyContainer.appendChild(minusBtn);
    qtyContainer.appendChild(qtySpan);
    qtyContainer.appendChild(plusBtn);
    qtyCell.appendChild(qtyContainer);
    row.appendChild(qtyCell);

    // Price
    const priceCell = document.createElement('td');
    const itemTotal = item.price * item.qty;
    priceCell.textContent = `‚Ç±${itemTotal}`;
    row.appendChild(priceCell);


    // Upgrade button
const upgradeCell = document.createElement('td');
const upgradeBtn = document.createElement('button');
upgradeBtn.textContent = 'UP';
upgradeBtn.style.backgroundColor = '#06812b';
upgradeBtn.style.color = 'white';
upgradeBtn.style.border = 'none';
upgradeBtn.style.padding = '3px 6px';
upgradeBtn.style.cursor = 'pointer';
upgradeBtn.style.borderRadius = '3px';
upgradeBtn.onclick = () => openUpgradeModal(item, index);
upgradeCell.appendChild(upgradeBtn);
row.appendChild(upgradeCell);



    // Delete button
    const deleteCell = document.createElement('td');
    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = 'Delete';
    deleteBtn.style.backgroundColor = '#ff4d4d';
    deleteBtn.style.color = 'white';
    deleteBtn.style.border = 'none';
    deleteBtn.style.padding = '3px 6px';
    deleteBtn.style.cursor = 'pointer';
    deleteBtn.style.borderRadius = '3px';
    deleteBtn.onclick = () => { cart.splice(index,1); renderCart(); };
    deleteCell.appendChild(deleteBtn);
    row.appendChild(deleteCell);

    cartTableBody.appendChild(row);

    subtotal += itemTotal;
  });

  // Apply 20% of discount input
  const discountInput = document.getElementById('discount');
  let discountValue = parseFloat(discountInput.value) || 0;
  const discountAmount = discountValue * 0.2;
  const total = Math.max(0, subtotal - discountAmount);

  subtotalSpan.textContent = subtotal.toFixed(2);
  discountSpan.textContent = discountAmount.toFixed(2);
  totalSpan.textContent = total.toFixed(2);
}

// Re-render cart on discount change
document.getElementById('discount').addEventListener('input', renderCart);

// Go to receipt
document.getElementById('goReceiptBtn').addEventListener('click', () => {
  if(cart.length === 0) { alert("Cart is empty!"); return; }
  localStorage.setItem('cart', JSON.stringify(cart));
  
  const discountValue = parseFloat(document.getElementById('discount').value) || 0;
  const discountAmount = discountValue * 0.2;
  localStorage.setItem('discount', discountAmount);

  window.location.href = 'receipt.html';
});

// Initial menu render
renderCategories();



let waitlist = JSON.parse(localStorage.getItem("waitlist")) || [];
const table = document.getElementById("waitlistTable");

function renderWaitlist() {
  table.innerHTML = "";
  if(waitlist.length === 0) {
    table.innerHTML = '<tr><td colspan="4">No waitlisted receipts</td></tr>';
    return;
  }

waitlist.forEach((r, index) => {
  const row = document.createElement("tr");
  row.innerHTML = `
    <td>${r.id}</td>
    <td>${r.customerName || "-"}</td>
    <td>${r.date}</td>
    <td>‚Ç±${r.total.toFixed(2)}</td>
    <td>
      <button class="save-btn" onclick="openSaveModal(${index})">To Pay</button>
      <button class="delete-btn" onclick="deleteFromWaitlist(${index})">‚ùå Delete</button>
    </td>
  `;
  table.appendChild(row);
});

}

function deleteFromWaitlist(index) {
  if(confirm("Delete this waitlisted receipt?")) {
    waitlist.splice(index, 1);
    localStorage.setItem("waitlist", JSON.stringify(waitlist));
    renderWaitlist();
  }
}

renderWaitlist();

// --- SAVE MODAL LOGIC ---
let currentWaitlistIndex = null;

const cashGivenInput = document.getElementById("cashGiven");
const changeAmountSpan = document.getElementById("changeAmount");
const totalDueSpan = document.getElementById("totalDue");

function updateChange() {
  const totalDue = parseFloat(totalDueSpan.textContent) || 0;
  const cashGiven = parseFloat(cashGivenInput.value) || 0;
  let change = cashGiven - totalDue;
  if (change < 0) change = 0;
  changeAmountSpan.textContent = change.toFixed(2);
  changeAmountSpan.style.color = cashGiven >= totalDue ? "lime" : "red";
}

cashGivenInput.addEventListener("input", updateChange);

function openSaveModal(index) {
  currentWaitlistIndex = index;
  const r = waitlist[index];

  totalDueSpan.textContent = r.total.toFixed(2);

  document.getElementById("payCash").value = r.payment?.cash || 0;
  document.getElementById("payGCash").value = r.payment?.gcash || 0;
  document.getElementById("payBank").value = r.payment?.bank || 0;
  document.getElementById("serviceSelect").value = r.service || "Dine-in";

  document.getElementById("paidTotal").textContent = getPaymentTotal().toFixed(2);

  cashGivenInput.value = "";
  changeAmountSpan.textContent = "0.00";

  document.getElementById("saveModal").style.display = "flex";
}

function closeSaveModal() {
  document.getElementById("saveModal").style.display = "none";
}

function getPaymentTotal() {
  const cash = parseFloat(document.getElementById("payCash").value) || 0;
  const gcash = parseFloat(document.getElementById("payGCash").value) || 0;
  const bank = parseFloat(document.getElementById("payBank").value) || 0;
  return cash + gcash + bank;
}

// Update total paid live
["payCash","payGCash","payBank"].forEach(id => {
  document.getElementById(id).addEventListener("input", () => {
    document.getElementById("paidTotal").textContent =
      getPaymentTotal().toFixed(2);
  });
});

// Save waitlisted receipt to history
document.getElementById("saveYes").addEventListener("click", () => {
  if(currentWaitlistIndex === null) return;
  const r = waitlist[currentWaitlistIndex];
  const paidTotal = getPaymentTotal();

  if(paidTotal !== r.total) {
    alert("Payment amount must equal total ‚Ç±" + r.total.toFixed(2));
    return;
  }

  // Update receipt info
  r.payment = {
    cash: parseFloat(document.getElementById("payCash").value) || 0,
    gcash: parseFloat(document.getElementById("payGCash").value) || 0,
    bank: parseFloat(document.getElementById("payBank").value) || 0
  };
  r.service = document.getElementById("serviceSelect").value;

  // Add to receipts history
  let receipts = JSON.parse(localStorage.getItem("receipts")) || [];
  receipts.push(r);
  localStorage.setItem("receipts", JSON.stringify(receipts));

  // Remove from waitlist
  waitlist.splice(currentWaitlistIndex, 1);
  localStorage.setItem("waitlist", JSON.stringify(waitlist));
  currentWaitlistIndex = null;

  renderWaitlist();
  closeSaveModal();
});
document.getElementById("saveCancel").addEventListener("click", closeSaveModal);


</script>

<script>
  function goToHistory() {
    window.location.href = "history.html";
  }
</script>

  <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker
      .register("service-worker.js")
      .then(() => console.log("Service Worker Registered"));
  }
</script>

</body>
</html>





