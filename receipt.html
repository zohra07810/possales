<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#06812b">
<link rel="icon" href="baigsLogo.png" type="image/png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POS Receipt</title>
<style>
body {
  margin: 0;
  padding: 0;
  font-family: monospace;
  background: #f5f5f5;
}

/* SCREEN DISPLAY */
.receipt {
  width: 100%;
  max-width: 420px;
  margin: 20px auto;
  padding: 16px;
  background: #fff;
  box-sizing: border-box;
  font-size: 18px;
}

h2 { text-align: center; font-size: 26px; margin: 8px 0; }
p { text-align: center; font-size: 18px; margin: 5px 0; }
.line { border-top: 1px dashed #000; margin: 10px 0; }

table { width: 100%; border-collapse: collapse; font-size: 18px; }
td { padding: 6px 0; }
.right { text-align: right; }
.total { font-weight: bold; font-size: 22px; }

button {
  width: 100%;
  padding: 14px;
  margin-top: 15px;
  font-size: 18px;
  cursor: pointer;
}

/* PRINT STYLES */
@media print {
  body { background: #fff; }
  .receipt {
    width: 80mm;
    max-width: 80mm;
    padding: 6px;
    font-size: 12px;
    margin: 0;
  }
  h2 { font-size: 16px; }
  p, table { font-size: 12px; }
  .total { font-size: 14px; }
  button { display: none; }
}

/* HEADER */
.header { text-align: center; margin-bottom: 15px; }
.logo { max-width: 80px; margin-bottom: 8px; }
.store-info { font-size: 16px; margin-top: 3px; }

.back-btn {
  width: auto;
  padding: 4px 10px;
  margin: 6px auto 0;
  font-size: 16px;
  cursor: pointer;
  color: #f5f5f5;
  background: #c91212;
  border: none;
  border-radius: 5px;
}

/* SAVE MODAL */
#saveModal {
  display: none;
  position: fixed; top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}
#saveModalContent {
  background: #06812b;
  color: white;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 350px;
  text-align: center;
}
#saveModalContent select {
  width: 90%;
  padding: 5px;
  margin: 5px 0;
  font-size: 16px;
}
#saveModalContent button {
  padding: 6px 12px;
  margin: 5px;
  cursor: pointer;
  border: none;
  border-radius: 5px;
  font-size: 14px;
}
#saveYes { background: white; color: #06812b; }
#saveCancel { background: #555; color: white; }

.payment-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 6px 0;
}

.payment-row span {
  font-size: 14px;
}

.payment-row input {
  width: 90px;
  padding: 4px;
  font-size: 14px;
  border-color: #d1ff04;     /* focused border */
  box-shadow: 0 0 0 2px rgba(114, 0, 63, 0.2);
}

/* Waitlist Modal CSS */
#waitlistModal {
  display: none; /* hidden by default */
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  z-index: 10000; /* high value to appear above everything */
  justify-content: center;
  align-items: center;
}


#waitlistModalContent {
  background: #056622;
  color: white;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 350px;
  text-align: center;
}

</style>
</head>
<body>

<div class="receipt">
  <div class="header">
    <img src="baigsLogo.png" alt="Logo" class="logo">
    <h2>Baig's Arab-Pakistani-Indian Restaurant</h2>
    <div class="store-info">0945-597-0707</div>
    <div class="store-info">B3A L3788 Brgy. Sta.Lucia Dasmari√±as City Cavite</div>
  </div>

  <p>Thank you!</p>
  <div class="line"></div>

  <table id="items"></table>

  <div class="line"></div>

  <table id="totalsTable">
    <tr>
      <td>Subtotal</td>
      <td class="right" id="subtotal"></td>
    </tr>
    <tr>
      <td>Discount</td>
      <td class="right" id="discountText"></td>
    </tr>
    <tr id="deliveryRow" style="display:none;">
  <td>Delivery Fee</td>
  <td class="right" id="deliveryText"></td>
  </tr>

    <tr class="total">
      <td>Total</td>
      <td class="right" id="total"></td>
    </tr>
  </table>

  <button onclick="window.print()" style=" background: #0c4b04; color: #f5f5f5;">Print Receipt</button><br>

  <div style="max-width: 400px; margin: 0 auto; text-align: center; padding: 4px 10px; background: #f8f8f8; border-radius: 8px;">
    <button onclick="openSaveModal()" style="padding: 8px 16px; font-size: 16px;">üíæ To Pay</button>
  </div><br>

  <div style="max-width: 400px; margin: 0 auto; text-align: center; padding: 4px 10px; background: #f8f8f8; border-radius: 8px;">
  <button onclick="openWaitlistModal()" style="padding: 8px 16px; font-size: 16px;">‚è≥ Add to Waitlist</button>
</div>


  <div style="text-align:center;">
    <button class="back-btn" onclick="goBack()">‚¨Ö Back to POS</button>
  </div>
</div>

<!-- Save Modal -->
<div id="saveModal">
  <div id="saveModalContent">

    <div style="margin-bottom:10px; font-size:24px; font-weight:bold; color:#fbff02;">
  Total to Pay: ‚Ç±<span id="totalDue">0.00</span>
</div>


  <div style="margin-top:12px; padding:8px; background:#056622; border-radius:6px;">
  <div style="font-size:14px;">
    <strong>Cash Change Calculator</strong>
  </div>

  <div style="margin-top:6px;">
    Cash Given: ‚Ç±
    <input type="number" id="cashGiven" placeholder="0.00"
           style="width:90px; padding:4px; font-size:14px;">
  </div>

  <div style="margin-top:6px; font-size:15px;">
    Change: ‚Ç±<span id="changeAmount">0.00</span>
  </div>
</div><br>

    <label>Payment Breakdown:</label>

    <div class="payment-row">
      <span>Cash</span>
      <input type="number" id="payCash" placeholder="0.00">
    </div>

    <div class="payment-row">
      <span>GCash</span>
      <input type="number" id="payGCash" placeholder="0.00">
    </div>

    <div class="payment-row">
      <span>Bank</span>
      <input type="number" id="payBank" placeholder="0.00">
    </div>


    <div style="margin-top:10px;">
      <strong>Total Paid: ‚Ç±<span id="paidTotal">0.00</span></strong>
    </div>

    


    <button id="saveYes">Save</button>
    <button id="saveCancel">Cancel</button>
  </div>
</div>

<!-- Waitlist Customer Modal -->
<div id="waitlistModal">
  <div id="waitlistModalContent">
    <h3>Waitlist Customer</h3>
    <div style="margin:10px 0;">
      <label>Customer Name:</label><br>
      <input type="text" id="waitlistName" placeholder="Enter name" style="width:90%; padding:6px; font-size:16px;">
    </div>
    <button id="waitlistSave">Add to Waitlist</button>
    <button id="waitlistCancel">Cancel</button>
  </div>
</div>




<script>



// =======================
// LOAD CART & CALCULATIONS
// =======================
const cart = JSON.parse(localStorage.getItem("cart")) || [];
const discountAmount = parseFloat(localStorage.getItem("discount")) || 0;
const deliveryFee = parseFloat(localStorage.getItem("deliveryFee")) || 0;
const service = localStorage.getItem("service") || "Dine-in";

const itemsTable = document.getElementById("items");
let subtotal = 0;

// Render items
cart.forEach(item => {
  const qty = item.qty || 1;
  const itemTotal = item.price * qty;

  const row = document.createElement("tr");
  row.innerHTML = `
    <td>${item.name} x${qty}</td>
    <td class="right">‚Ç±${itemTotal.toFixed(2)}</td>
  `;
  itemsTable.appendChild(row);

  subtotal += itemTotal;
});

// Base total
let finalTotal = Math.max(0, subtotal - discountAmount);

// Add delivery fee ONLY if Delivery
if (service === "Delivery" && deliveryFee > 0) {
  finalTotal += deliveryFee;

  // show delivery row
  const deliveryRow = document.getElementById("deliveryRow");
  if (deliveryRow) {
    deliveryRow.style.display = "table-row";
    document.getElementById("deliveryText").textContent = "‚Ç±" + deliveryFee.toFixed(2);
  }
} else {
  // hide delivery row for other services
  const deliveryRow = document.getElementById("deliveryRow");
  if (deliveryRow) deliveryRow.style.display = "none";
}

// Display totals
document.getElementById("subtotal").textContent = "‚Ç±" + subtotal.toFixed(2);
document.getElementById("discountText").textContent = "-‚Ç±" + discountAmount.toFixed(2);
document.getElementById("total").textContent = "‚Ç±" + finalTotal.toFixed(2);

const totalsTable = document.getElementById("totalsTable");

// Get cashier from localStorage
const savedCashier = localStorage.getItem("cashier") || "‚Äî";

// Insert into totalsTable for receipt display
const serviceRow = document.createElement("tr");
serviceRow.innerHTML = `<td>Service Type:</td><td class="right">${service}</td>`;

const cashierRow = document.createElement("tr");
cashierRow.innerHTML = `<td>Cashier:</td><td class="right">${savedCashier}</td>`;


// Insert Service and Cashier above subtotal (at the top)
totalsTable.insertBefore(cashierRow, totalsTable.firstChild); // Cashier first
totalsTable.insertBefore(serviceRow, totalsTable.firstChild); // Then Service


// =======================
// NAVIGATION
// =======================
function goBack() {
  window.location.href = "index.html";
}

// =======================
// CASH CHANGE CALCULATOR
// =======================
const cashGivenInput = document.getElementById("cashGiven");
const changeAmountSpan = document.getElementById("changeAmount");
const totalDueSpan = document.getElementById("totalDue");

function updateChange() {
  const totalDue = parseFloat(totalDueSpan.textContent) || 0;
  const cashGiven = parseFloat(cashGivenInput.value) || 0;

  let change = cashGiven - totalDue;
  if (change < 0) change = 0;

  changeAmountSpan.textContent = change.toFixed(2);
  changeAmountSpan.style.color = cashGiven >= totalDue ? "lime" : "red";
}

cashGivenInput.addEventListener("input", updateChange);

// =======================
// SAVE MODAL
// =======================
function openSaveModal() {
  totalDueSpan.textContent = finalTotal.toFixed(2);

  document.getElementById("payCash").value = "";
  document.getElementById("payGCash").value = "";
  document.getElementById("payBank").value = "";
  document.getElementById("paidTotal").textContent = "0.00";

  cashGivenInput.value = "";
  changeAmountSpan.textContent = "0.00";

  document.getElementById("saveModal").style.display = "flex";
}

function closeSaveModal() {
  document.getElementById("saveModal").style.display = "none";
}

function getPaymentTotal() {
  const cash = parseFloat(document.getElementById("payCash").value) || 0;
  const gcash = parseFloat(document.getElementById("payGCash").value) || 0;
  const bank = parseFloat(document.getElementById("payBank").value) || 0;
  return cash + gcash + bank;
}

// Live update paid total
["payCash","payGCash","payBank"].forEach(id => {
  document.getElementById(id).addEventListener("input", () => {
    document.getElementById("paidTotal").textContent =
      getPaymentTotal().toFixed(2);
  });
});

// =======================
// SAVE RECEIPT
// =======================
document.getElementById("saveYes").addEventListener("click", () => {
  const paidTotal = getPaymentTotal();

  if (paidTotal !== finalTotal) {
    alert("Payment amount must equal total ‚Ç±" + finalTotal.toFixed(2));
    return;
  }

  const receiptObj = {
    id: Date.now(),
    date: new Date().toLocaleString(),
    items: cart,
    subtotal,
    discount: discountAmount,
    deliveryFee: service === "Delivery" ? deliveryFee : 0,
    total: finalTotal,
    payment: {
      cash: parseFloat(document.getElementById("payCash").value) || 0,
      gcash: parseFloat(document.getElementById("payGCash").value) || 0,
      bank: parseFloat(document.getElementById("payBank").value) || 0
    },
    service,
    cashier: savedCashier
    
  };

  let receipts = JSON.parse(localStorage.getItem("receipts")) || [];
  receipts.push(receiptObj);
  localStorage.setItem("receipts", JSON.stringify(receipts));

  closeSaveModal();
  window.location.href = "history.html";
});

// Cancel button closes the save modal
document.getElementById("saveCancel").addEventListener("click", () => {
  closeSaveModal();
});

// =======================
// WAITLIST
// =======================
const waitlistModal = document.getElementById("waitlistModal");
const waitlistNameInput = document.getElementById("waitlistName");
const waitlistSaveBtn = document.getElementById("waitlistSave");
const waitlistCancelBtn = document.getElementById("waitlistCancel");

function openWaitlistModal() {
  waitlistNameInput.value = "";
  waitlistModal.style.display = "flex";
}

function closeWaitlistModal() {
  waitlistModal.style.display = "none";
}

waitlistCancelBtn.addEventListener("click", closeWaitlistModal);

waitlistSaveBtn.addEventListener("click", () => {
  const customerName = waitlistNameInput.value.trim();
  if (!customerName) {
    alert("Please enter customer name!");
    return;
  }

  const waitlistObj = {
    id: Date.now(),
    date: new Date().toLocaleString(),
    customerName,
    items: cart,
    subtotal,
    discount: discountAmount,
    deliveryFee: service === "Delivery" ? deliveryFee : 0,
    total: finalTotal,
    payment: {
      cash: parseFloat(document.getElementById("payCash").value) || 0,
      gcash: parseFloat(document.getElementById("payGCash").value) || 0,
      bank: parseFloat(document.getElementById("payBank").value) || 0
    },
    service
  };

  let waitlist = JSON.parse(localStorage.getItem("waitlist")) || [];
  waitlist.push(waitlistObj);
  localStorage.setItem("waitlist", JSON.stringify(waitlist));

  alert("Receipt added to waitlist!");
  closeWaitlistModal();
});
</script>





</body>
</html>
